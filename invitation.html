<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=640,target-densitydpi=device-dpi,user-scalable=no" />
    <title>活动申请</title>   
    <script src="jweixin-1.3.2.js"></script>
    <script src="jquery-1.11.2.min.js"></script>
    <script src="fun.js?3"></script>
    <script>

        function login() {
            var code = getParamer("code"); 
            var url = "https://www.view-ol.com/viewol_web/wx/mpLogin?jscode="+code
            var data = {}
            http_request( url , data , function(re){
                var re = JSON.parse(re)
                if(re.status=="0000"){
                    //登录成功
                    isPerfectnfo(re.result.sessionId , re.result.userId);
                }else{
                    alert(re.message)
                }
            });
        }

        function isPerfectnfo(sessionId="" , userId=""){
            var url = "https://www.view-ol.com/viewol_web/fuser/isPerfectnfo?userId="+userId
            var data = {}
            var header = {
                "userId": userId,
                "sessionId": sessionId
            }
            http_request2( url , data , header ,  function(re){
                var re = JSON.parse(re)
                if(re.status=="0000"){
                    //信息已完善
                    window.location.href="https://www.view-ol.com/mobile/welcome.html?userId="+userId+"&sessionId="+sessionId;
                }else{
                    //信息未完善
                    window.location.href="https://www.view-ol.com/mobile/editUserInfo.html?userId="+userId+"&sessionId="+sessionId+"&action=3";
                }
            });
        }
        
    </script>
</head>

<body>
<script>

</script>

<style type="text/css">
    body{background:#0b1457;}
    html,body,ul,li,p{padding:0;margin:0;}
    .outbox{background:url(images/cz.jpg) no-repeat center top;background-size:100% auto;width:100%;height: 100%;position: relative;min-height: 1160px;}
    .outbox .apply{width:400px;height:70px;font-size: 26px;color: #3d3ab2;font-weight: bold;border-radius:80px;background:#fff;top:900px;text-align: center;line-height:70px;left:50%;margin-left:-204px;position:absolute;border:4px #11357c solid;}
</style>

<div class="outbox">
    <div class="apply" onclick="login()">我要参加</div>
</div>

</body>
</html>